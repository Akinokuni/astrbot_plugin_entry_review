# 入群申请审核插件部署指南

## 插件简介

本插件为AstrBot提供入群申请审核功能，支持：
- 自动转发入群申请到指定审核群
- 管理员通过命令批准/拒绝申请
- 自动超时批准机制
- 完整的日志记录和错误处理

## 部署步骤

### 1. 插件安装

将整个插件目录复制到AstrBot的插件目录中：
```
astrbot/plugins/astrbot_plugin_entry_review/
├── main.py
├── metadata.yaml
├── _conf_schema.json
├── README.md
├── LICENSE
└── DEPLOYMENT.md
```

### 2. 基础配置

在AstrBot管理界面或配置文件中设置以下参数：

```json
{
  "source_group": "123456789",          // 需要监听入群申请的群号
  "target_group": "987654321",          // 审核群号（管理员处理申请的群）
  "auto_approve_timeout": 300,           // 自动批准超时时间（秒）
  "command_permission_check": true,      // 是否检查命令权限
  "request_message_template": "用户 {nickname}({user_id}) 申请加入群 {group_id}\n申请理由: {comment}\n时间: {timestamp}\n\n回复 '通过 {user_id}' 或 '拒绝 {user_id} [理由]' 进行处理",
  "approve_message_template": "✅ 用户 {user_id} 的入群申请已通过\n操作员: {operator}\n时间: {timestamp}",
  "reject_message_template": "❌ 用户 {user_id} 的入群申请已拒绝\n操作员: {operator}\n理由: {reason}\n时间: {timestamp}"
}
```

### 3. 权限设置

确保机器人在以下群中具有相应权限：

**源群（source_group）**：
- 接收群通知权限
- 处理入群申请权限

**审核群（target_group）**：
- 发送消息权限
- 接收消息权限

### 4. 启动插件

重启AstrBot或重新加载插件配置，插件将自动启动。

## 使用方法

### 管理员命令

在审核群中，管理员可以使用以下命令：

1. **批准申请**：
   ```
   通过 123456789
   ```

2. **拒绝申请**：
   ```
   拒绝 123456789 不符合入群要求
   ```

3. **配置管理**：
   ```
   设置源群 123456789
   设置审核群 987654321
   设置超时时间 600
   查看配置
   ```

### 工作流程

1. 用户申请加入源群
2. 插件自动捕获申请事件
3. 将申请信息转发到审核群
4. 管理员在审核群中处理申请
5. 插件执行相应操作并发送结果通知
6. 如果超时未处理，自动批准申请

## 故障排除

### 常见问题

1. **插件无法启动**
   - 检查AstrBot版本兼容性
   - 确认插件文件完整性
   - 查看AstrBot日志

2. **无法接收入群申请**
   - 确认源群号配置正确
   - 检查机器人在源群的权限
   - 确认群设置允许机器人接收通知

3. **审核命令无效**
   - 确认审核群号配置正确
   - 检查命令格式是否正确
   - 确认发送者具有管理员权限

4. **自动批准不工作**
   - 检查超时时间设置
   - 确认机器人具有处理申请的权限
   - 查看错误日志

### 日志查看

插件会记录详细的运行日志，包括：
- 申请接收和处理
- 命令执行结果
- 错误和异常信息

在AstrBot日志中查找 `[EntryReviewPlugin]` 标签的日志条目。

## 高级配置

### 消息模板自定义

可以自定义各种消息模板，支持的变量包括：
- `{user_id}`: 用户ID
- `{nickname}`: 用户昵称
- `{group_id}`: 群号
- `{comment}`: 申请理由
- `{timestamp}`: 时间戳
- `{operator}`: 操作员
- `{reason}`: 拒绝理由

### 权限控制

设置 `command_permission_check: false` 可以禁用权限检查，允许所有用户执行管理命令（不推荐）。

## 技术支持

如遇到问题，请：
1. 查看AstrBot和插件日志
2. 确认配置参数正确
3. 检查机器人权限设置
4. 参考README.md中的详细说明

---

**注意**：本插件需要AstrBot框架支持，请确保使用兼容版本。